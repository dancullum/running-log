{% extends "base.html" %}

{% block title %}Dashboard - Running Log{% endblock %}

{% block content %}
<!-- Today's Target Card -->
<div class="card today-card">
    <div class="card-title">Today's Target</div>
    {% if today_target and today_target > 0 %}
        <div class="today-target">{{ today_target|format_distance }}</div>
        {% if today_run %}
            <p style="color: #155724; margin-top: 0.5rem;">
                Logged: {{ today_run|format_distance }}
                {% if today_run >= today_target %}
                    - Target met!
                {% else %}
                    ({{ (today_target - today_run)|round(1) }} km to go)
                {% endif %}
            </p>
        {% else %}
            <a href="{{ url_for('log_form') }}" class="quick-log-btn">Log Today's Run</a>
        {% endif %}
    {% elif today_target == 0 %}
        <div class="rest-day">Rest Day</div>
        <p style="margin-top: 0.5rem; color: #888;">Enjoy your recovery!</p>
    {% else %}
        <div class="rest-day">No target scheduled</div>
    {% endif %}
</div>

<!-- Progress Card -->
<div class="card">
    <div class="card-title">Progress to 50km Ultra</div>
    <div class="progress-container">
        <div class="progress-bar" style="width: {{ stats.ultra_progress }}%"></div>
    </div>
    <div class="progress-text">
        <span>{{ stats.total_distance|round(1) }} km logged</span>
        <span>{{ stats.ultra_goal|int }} km goal</span>
    </div>

    <div class="week-summary">
        <div class="week-stat">
            <div class="week-stat-value">{{ stats.run_count }}</div>
            <div class="week-stat-label">Runs</div>
        </div>
        <div class="week-stat">
            <div class="week-stat-value">{{ stats.total_distance|round(1) }}</div>
            <div class="week-stat-label">Total km</div>
        </div>
        <div class="week-stat">
            <div class="week-stat-value">{{ stats.plan_progress|round(0)|int }}%</div>
            <div class="week-stat-label">Plan Done</div>
        </div>
    </div>
</div>

<!-- This Week Card -->
<div class="card">
    <div class="card-title">This Week ({{ week_summary.start|format_date_short }} - {{ week_summary.end|format_date_short }})</div>
    <div class="week-summary">
        <div class="week-stat">
            <div class="week-stat-value">{{ week_summary.total_run|round(1) }}</div>
            <div class="week-stat-label">km Run</div>
        </div>
        <div class="week-stat">
            <div class="week-stat-value">{{ week_summary.total_target|round(1) }}</div>
            <div class="week-stat-label">km Target</div>
        </div>
        <div class="week-stat">
            <div class="week-stat-value">{{ week_summary.days_logged }}</div>
            <div class="week-stat-label">Days Logged</div>
        </div>
    </div>
</div>

<!-- Recent Runs Card -->
<div class="card">
    <div class="card-title">Recent Runs</div>
    {% if recent_runs %}
        <ul class="run-list">
            {% for run in recent_runs %}
            <li class="run-item">
                <div>
                    <span class="run-date">{{ run.date|format_date }}</span>
                    {% if run.target %}
                        <span class="target-label">(target: {{ run.target|format_distance }})</span>
                    {% endif %}
                </div>
                <div>
                    <span class="run-distance">{{ run.distance|format_distance }}</span>
                    {% if run.diff is not none %}
                        <span class="run-diff {% if run.diff >= 0 %}diff-positive{% else %}diff-negative{% endif %}">
                            {% if run.diff >= 0 %}+{% endif %}{{ run.diff|round(1) }}
                        </span>
                    {% endif %}
                </div>
            </li>
            {% endfor %}
        </ul>
        <div style="text-align: center; margin-top: 1rem;">
            <a href="{{ url_for('history') }}" class="btn btn-secondary" style="display: inline-block; width: auto; padding: 0.5rem 1rem;">
                View All Runs
            </a>
        </div>
    {% else %}
        <div class="empty-state">
            <p>No runs logged yet.</p>
            <a href="{{ url_for('log_form') }}" class="btn btn-primary" style="margin-top: 1rem; display: inline-block; width: auto; padding: 0.75rem 1.5rem;">
                Log Your First Run
            </a>
        </div>
    {% endif %}
</div>
{% endblock %}
